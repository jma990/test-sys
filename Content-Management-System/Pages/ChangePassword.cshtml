@page
@model Content_Management_System.Pages.ChangePasswordModel
@{
}

@section Styles {
    <link rel="stylesheet" href="@Url.Content(PathDirectory.ChangePasswordCSS)" />
}

@section Scripts {
    @if (TempData["SuccessMessage"] != null)
    {
        <script>
            Swal.fire({
                icon: 'success',
                title: 'Success',
                text: '@TempData["SuccessMessage"]'
            });
        </script>
    }

    @if (TempData["ErrorMessage"] != null)
    {
        <script>
            Swal.fire({
                icon: 'error',
                title: 'Error',
                text: '@TempData["ErrorMessage"]'
            });
        </script>
    }

    <script>
        function togglePassword(inputId, buttonId) {
            const input = document.getElementById(inputId);
            const button = document.getElementById(buttonId);
            const icon = button.querySelector('i');

            if (input.type === "password") {
                input.type = "text";
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
                button.setAttribute('aria-label', 'Hide password');
            } else {
                input.type = "password";
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
                button.setAttribute('aria-label', 'Show password');
            }
        }

        // Add loading state to submit button
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.querySelector('.change-password-form');
            if (form) {
                form.addEventListener('submit', function() {
                    const btn = form.querySelector('.btn-submit');
                    if (btn) {
                        btn.disabled = true;
                        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Updating...';
                    }
                });
            }
        });
    </script>
}

<div class="change-password-container">
    <div class="change-password-header">
        <h2>Change Password</h2>
        <p>Update your password to keep your account secure</p>
    </div>

    <form method="post" class="change-password-form">
        <div class="form-group">
            <label asp-for="Input.CurrentPassword" class="form-label">
                Current Password
                <span class="text-danger">*</span>
            </label>
            <div class="input-group">
                <input asp-for="Input.CurrentPassword" 
                       type="password" 
                       class="form-control" 
                       id="currentPassword" 
                       placeholder="Enter your current password"
                       value="@Model.Input.CurrentPassword" 
                       autocomplete="current-password" />
                <button type="button" 
                        class="password-toggle-btn" 
                        id="toggleCurrent" 
                        onclick="togglePassword('currentPassword', 'toggleCurrent')"
                        aria-label="Show password">
                    <i class="fas fa-eye"></i>
                </button>
            </div>
            <span asp-validation-for="Input.CurrentPassword" class="text-danger"></span>
        </div>

        <div class="form-group">
            <label asp-for="Input.NewPassword" class="form-label">
                New Password
                <span class="text-danger">*</span>
            </label>
            <div class="input-group">
                <input asp-for="Input.NewPassword" 
                       type="password" 
                       class="form-control" 
                       id="newPassword" 
                       placeholder="Enter your new password"
                       value="@Model.Input.NewPassword" 
                       autocomplete="new-password" />
                <button type="button" 
                        class="password-toggle-btn" 
                        id="toggleNew" 
                        onclick="togglePassword('newPassword', 'toggleNew')"
                        aria-label="Show password">
                    <i class="fas fa-eye"></i>
                </button>
            </div>
            <span asp-validation-for="Input.NewPassword" class="text-danger"></span>
        </div>

        <div class="form-group">
            <label asp-for="Input.ConfirmPassword" class="form-label">
                Confirm New Password
                <span class="text-danger">*</span>
            </label>
            <div class="input-group">
                <input asp-for="Input.ConfirmPassword" 
                       type="password" 
                       class="form-control" 
                       id="confirmPassword" 
                       placeholder="Re-enter your new password"
                       value="@Model.Input.ConfirmPassword" 
                       autocomplete="new-password" />
                <button type="button" 
                        class="password-toggle-btn" 
                        id="toggleConfirm" 
                        onclick="togglePassword('confirmPassword', 'toggleConfirm')"
                        aria-label="Show password">
                    <i class="fas fa-eye"></i>
                </button>
            </div>
            <span asp-validation-for="Input.ConfirmPassword" class="text-danger"></span>
        </div>

        <div class="form-actions">
            <button type="submit" class="btn-submit">
                <i class="fas fa-save"></i>
                Save Changes
            </button>
            <a href="@Url.Content(PathDirectory.AccountSettingsPage)" class="btn-cancel">
                Cancel
            </a>
        </div>
    </form>
</div>